<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Process - {{ job.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .round-card {
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        .round-card.locked {
            opacity: 0.6;
            pointer-events: none;
        }
        .round-card.completed {
            border-left: 5px solid #28a745;
        }
        .round-card.current {
            border-left: 5px solid #007bff;
        }
        .status-badge {
            float: right;
        }
        .progress-container {
            margin: 30px 0;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h2>Application Process for: {{ job.title }}</h2>
                <p class="text-muted">at {{ job.employer.company_name }}</p>
                
                <div class="progress-container">
                    <div class="progress">
                        {% set progress = 0 %}
                        {% if application.status == 'Applied' %}
                            {% set progress = 25 %}
                        {% elif application.status == 'Aptitude Test' %}
                            {% set progress = 50 %}
                        {% elif application.status == 'Coding Test' or application.status == 'Video Round' %}
                            {% set progress = 75 %}
                        {% elif application.status == 'Project Round' %}
                            {% set progress = 100 %}
                        {% endif %}
                        <div class="progress-bar" role="progressbar" style="width: {{ progress }}%" 
                             aria-valuenow="{{ progress }}" aria-valuemin="0" aria-valuemax="100">
                            {{ progress }}%
                        </div>
                    </div>
                    <small class="text-muted">Current status: {{ application.status }}</small>
                </div>

                <div class="card round-card {% if application.status != 'Applied' %}completed{% elif application.status == 'Applied' %}current{% endif %}">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            Round 1: ATS Resume Screening
                            {% if application.status != 'Applied' %}
                                <span class="badge bg-success status-badge">Completed</span>
                            {% elif application.status == 'Applied' %}
                                <span class="badge bg-primary status-badge">In Progress</span>
                            {% endif %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <p>Your resume will be automatically screened by our ATS system to match job requirements.</p>
                        {% if application.status == 'Applied' %}
                            <p class="text-info">Your resume is currently being screened. Please check back later.</p>
                        {% else %}
                            <p class="text-success">Resume screening completed. You may proceed to the next round.</p>
                        {% endif %}
                    </div>
                </div>

                <div class="card round-card {% if application.status in ['Aptitude Test', 'Coding Test', 'Video Round', 'Project Round'] %}completed{% elif application.status == 'Aptitude Test' %}current{% else %}{% if application.status == 'Applied' %}locked{% endif %}{% endif %}">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            Round 2: Aptitude Test
                            {% if application.status in ['Aptitude Test', 'Coding Test', 'Video Round', 'Project Round'] %}
                                <span class="badge bg-success status-badge">Completed</span>
                            {% elif application.status == 'Aptitude Test' %}
                                <span class="badge bg-primary status-badge">In Progress</span>
                            {% else %}
                                <span class="badge bg-secondary status-badge">Locked</span>
                            {% endif %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <p>This round consists of multiple-choice questions to assess your problem-solving abilities.</p>
                        {% if application.status in ['Aptitude Test', 'Coding Test', 'Video Round', 'Project Round'] %}
                            <p class="text-success">Aptitude test completed with score: {{ application.aptitude_score or 'N/A' }}</p>
                        {% elif application.status == 'Aptitude Test' %}
                            <a href="{{ url_for('take_aptitude_test', application_id=application.id) }}" class="btn btn-primary">Start Test</a>
                        {% else %}
                            <p class="text-muted">Complete the previous round to unlock this test.</p>
                        {% endif %}
                    </div>
                </div>

                <div class="card round-card {% if application.status in ['Coding Test', 'Video Round', 'Project Round'] %}completed{% elif application.status == 'Coding Test' or application.status == 'Video Round' %}current{% else %}{% if application.status in ['Applied', 'Aptitude Test'] %}locked{% endif %}{% endif %}">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            {% if job.role_type == 'Developer' %}
                                Round 3: Coding Test
                            {% else %}
                                Round 3: Video Response
                            {% endif %}
                            {% if application.status in ['Coding Test', 'Video Round', 'Project Round'] %}
                                <span class="badge bg-success status-badge">Completed</span>
                            {% elif application.status == 'Coding Test' or application.status == 'Video Round' %}
                                <span class="badge bg-primary status-badge">In Progress</span>
                            {% else %}
                                <span class="badge bg-secondary status-badge">Locked</span>
                            {% endif %}
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if job.role_type == 'Developer' %}
                            <p>This coding test will evaluate your programming skills relevant to the position.</p>
                            {% if application.status in ['Coding Test', 'Project Round'] %}
                                <p class="text-success">Coding test completed with score: {{ application.coding_score or 'N/A' }}</p>
                            {% elif application.status == 'Coding Test' %}
                                <a href="{{ url_for('take_coding_test', application_id=application.id) }}" class="btn btn-primary">Start Coding Test</a>
                            {% else %}
                                <p class="text-muted">Complete the previous round to unlock this test.</p>
                            {% endif %}
                        {% else %}
                            <p>This video response round will assess your communication and role-specific skills.</p>
                            {% if application.status in ['Video Round', 'Project Round'] %}
                                <p class="text-success">Video response submitted successfully.</p>
                            {% elif application.status == 'Video Round' %}
                                <a href="{{ url_for('take_video_interview', application_id=application.id) }}" class="btn btn-primary">Start Video Interview</a>
                            {% else %}
                                <p class="text-muted">Complete the previous round to unlock this interview.</p>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>

                <div class="card round-card {% if application.status == 'Project Round' %}completed{% elif application.status == 'Project Round' %}current{% else %}locked{% endif %}">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            Round 4: Project Submission
                            {% if application.status == 'Project Round' %}
                                <span class="badge bg-primary status-badge">In Progress</span>
                            {% else %}
                                <span class="badge bg-secondary status-badge">Locked</span>
                            {% endif %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <p>Submit a mini-project that demonstrates your skills relevant to the position.</p>
                        {% if application.status == 'Project Round' %}
                            <a href="{{ url_for('submit_project', application_id=application.id) }}" class="btn btn-primary">Submit Project</a>
                        {% else %}
                            <p class="text-muted">Complete the previous rounds to unlock this round.</p>
                        {% endif %}
                    </div>
                </div>

                <div class="mt-4">
                    <a href="{{ url_for('candidate_dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>